; The following program is like canontests/test02/m1 method for HW9
; which is to find the max number in an array a[i...length-1]

define i32 @main() #0 {
;initialize array a and int i
lbegin:
  %a = call i32* @malloc(i32 48)

  store i32 5, i32* %a
  %offset0 = getelementptr i32, i32* %a, i32 1
  store i32 4, i32* %offset0 
  %offset1 = getelementptr i32, i32* %a, i32 2
  store i32 3, i32* %offset1 
  %offset2 = getelementptr i32, i32* %a, i32 3
  store i32 2, i32* %offset2 
  %offset3 = getelementptr i32, i32* %a, i32 4
  store i32 1, i32* %offset3 
  %offset4 = getelementptr i32, i32* %a, i32 5
  store i32 0, i32* %offset4 

  %i0 = add i32 0, 0
  %m0 = add i32 -100, 0
  %l = load i32, i32* %a
  br label %lwhiletest

lwhiletest:
  %i2 = phi i32 [%i0, %lbegin], [%i1, %lifend]
  %m2 = phi i32 [%m0, %lbegin], [%m3, %lifend]
  %cond0 = icmp sgt i32 %l, %i2
  br i1 %cond0, label %lwhiletrue, label %lwhilefalse

lwhilefalse:
  ret i32 %m2

lwhiletrue:
  %iplus1 = add i32 %i2, 1
  %offset = getelementptr i32, i32* %a, i32 %iplus1
  %v = load i32, i32* %offset
  %cond1 = icmp sgt i32 %v, %m2
  br i1 %cond1, label %liftrue, label %lifend

lifend:
  %m3 = phi i32 [%m1, %liftrue], [%m2, %lwhiletrue]
  %i1 = add i32 %i2, 1
  br label %lwhiletest

liftrue:
  %m1 = add i32 %v, 0
  br label %lifend

}

declare i32* @malloc(i32)
